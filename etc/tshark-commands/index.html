<!DOCTYPE HTML> <html lang="en-US"> <head> <title>AppKubos: TShark Commands</title> <meta http-equiv="content-type" content="text/html; charset=utf-8"/> <meta name="description" content="TShark Commands"/> <meta name="HandheldFriendly" content="True"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="referrer" content="origin"/> <link rel="icon" href="/favicon.ico" type="image/x-icon"> <!--[if lte IE 8]><script src="/assets/css/ie/html5shiv.js"></script><![endif]--> <noscript> <link rel="stylesheet" href="/assets/css/skel.css"/> <link rel="stylesheet" href="/assets/css/style.css"/> <link rel="stylesheet" href="/assets/css/style-wide.css"/> </noscript> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> <script async src="/assets/js/jquery.dropotron.min.js"></script> <script src="/assets/js/skel.min.js"></script> <script src="/assets/js/skel-layers.min.js"></script> <script src="/assets/js/init.js"></script> <script async src="/assets/js/lunr.min.js"></script> <script async src="/assets/js/search.js"></script> <link rel="alternate" type="application/rss+xml" title="AppKubos" href="http://www.appkubos.com/feed.xml"/> </head> <body> <div id="header"> <nav id="nav"> <ul> <li><a href="/">Home</a></li> <li><a href="/pujan">About</a></li> <li class="headmenu" data-cat="javaee" data-curr="etc"> <a name="JavaEE">JavaEE</a> <ul> <li><a href=""></a></li> <li><a href="/javaee/ws/soapvsrest/">SOAP vs REST</a></li> <li><a href="/javaee/spring/security/credential/">Spring Security Credentails See Password at Session</a></li> <li><a href="/javaee/spring/configuration/">Spring Security Configuration with Form Login</a></li> <li><a href="/javaee/jboss/jspfix/">JBoss Fix for JSP</a></li> <li><a href="/javaee/processbuilder/">How to Run System Commands in Java</a></li> <li><a href="/javaee/jackson/csv-creator/">CSV Creator using Jackson</a></li> <li><a href="/javaee/jaxws/sample-webservice/">JAX-WS Webservices using Annotations</a></li> </ul> </li><li class="headmenu" data-cat="other" data-curr="etc"> <a name="Other">Other</a> <ul> <li><a href=""></a></li> <li><a href="/etc/calendar-next-4-months/">Calendar For Next Four Months</a></li> <li><a href="/etc/curl/">Curl Command</a></li> <li><a href="/etc/http2/">HTTP/2 Explained</a></li> <li><a href="/etc/tshark-commands/">TShark Commands</a></li> <li><a href="/etc/latency/">Latency Comparison</a></li> <li><a href="/etc/scala-introduction/">Scala Introduction</a></li> <li><a href="/etc/groovy-run-from-java/">Run Groovy from Java</a></li> </ul> </li><li class="headmenu" data-cat="python" data-curr="etc"> <a name="Python">Python</a> <ul> <li><a href=""></a></li> <li><a href="/python/tutorial/">Python Tutorial</a></li> <li><a href="/python/file-handling/">Python File Handling</a></li> <li><a href="/python/dictionary/">Python Dictionary</a></li> </ul> </li><li class="headmenu" data-cat="integration" data-curr="etc"> <a name="Integration">Integration</a> <ul> <li><a href=""></a></li> <li><a href="/integration/microservices/">Microservices Explained</a></li> <li><a href="/integration/oauth2/">OAuth2 Architecture</a></li> </ul> </li> </ul> </nav> </div> <section class="wrapper style1"> <div class="container"> <section> <header class="major"> <h2>TShark Commands</h2> </header> <div class="row"> <div class="12u"> <div class="box post"> <p>Â </p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Check which network interfaces are available.</span>
tshark -D
	1. en0
	2. fw0
	3. en1
	4. lo0

<span class="c"># Now capture on en0 interface</span>
tshark -i en0

<span class="c"># Capture goes to capture.cap file for later use</span>
tshark -r capture.cap


<span class="c"># Interested in HTTP traffic</span>
tshark -R <span class="s1">&#39;http&#39;</span> -i en0
tshark -i en0 port 80
tshark -f <span class="s1">&#39;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&#39;</span> -i en1

<span class="c"># Interested in SDP traffic</span>
tshark -R <span class="s1">&#39;sdp&#39;</span> -i en1

<span class="c"># display packets for 13 seconds: </span>
tshark -i en1 -S -a duration:13

<span class="c"># display and write packets to capture_write file for 13 seconds: </span>
tshark -S -q -w capture_out -a duration:13

<span class="c"># From Speific Host(192.168,1,150): </span>
tshark -S -q -w capture_duration6 -a duration:6 -z io,stat,1,ip.addr<span class="o">==</span>192.168.1.150

<span class="c">#Capture packets that r coming either to port 1720 or 1721 and save to capture_dump.pcap</span>
tshark -f  <span class="s2">&quot;port 1720 or port 1721&quot;</span> -w capture_dump.pcap
tshark -R <span class="s1">&#39;mpeg&#39;</span> -i en1
tshark -R <span class="s1">&#39;h264&#39;</span> -i en1

tshark -z <span class="s2">&quot;proto,colinfo,tcp.srcport,tcp.srcport&quot;</span> -r /tmp/capture.cap

Here is a more advanced example:

tshark -R <span class="s2">&quot;http.response and http.content_type contains image&quot;</span> <span class="se">\</span>
-z <span class="s2">&quot;proto,colinfo,http.content_length,http.content_length&quot;</span> <span class="se">\</span>
-z <span class="s2">&quot;proto,colinfo,http.content_type,http.content_type&quot;</span> <span class="se">\</span>
-r /tmp/capture.tmp

<span class="c"># Read pcap file prettier way</span>
tcpdump -qns <span class="m">0</span> -A<span class="p">|</span>X -r blah.pcap

<span class="c">#===================================================================</span>
<span class="c">#SIP Statistics</span>
<span class="c">#===================================================================</span>
tshark -r jit2.pcap -qz sip,stat
<span class="o">===================================================================</span>
SIP Statistics

Number of SIP messages: 11
Number of resent SIP messages: 0

* SIP Status Codes in reply packets
  SIP <span class="m">407</span> Proxy Authentication Required :     <span class="m">1</span> Packets
  SIP <span class="m">200</span> OK              :     <span class="m">3</span> Packets
  SIP <span class="m">100</span> Trying          :     <span class="m">1</span> Packets

* List of SIP Request methods
  ACK             :     <span class="m">1</span> Packets
  INVITE          :     <span class="m">2</span> Packets
  REGISTER        :     <span class="m">2</span> Packets
  CANCEL          :     <span class="m">1</span> Packets

* Average setup <span class="nb">time </span><span class="m">593364756</span> ms
 Min <span class="m">11</span> ms
 Max <span class="m">1802658152</span> <span class="nv">ms</span>
<span class="o">===================================================================</span>
tshark -R <span class="s2">&quot;sip.User-Agent&quot;</span> -r jit.pcap
tshark -R <span class="s2">&quot;sip.uri&quot;</span> -r jit.pcap</code></pre></figure> <h3 id="terminology-usedbr">Terminology Used<br/></h3> <p>-i = Network Interface<br/> -f = capture filter<br/> -R= display filter<br/> -c= how many packets you want to capture.<br/> -w=save o/p as a file.<br/> -F=what kind of packets you want to save.<br/> <br/><br/></p> <table> <thead> <tr> <th style="text-align: left">Protocol</th> <th style="text-align: left">Explanation</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">arp</td> <td style="text-align: left">Address Resolution Protocol</td> </tr> <tr> <td style="text-align: left">esp</td> <td style="text-align: left">Encapsulating Security Payload</td> </tr> <tr> <td style="text-align: left">icmp | icmp6</td> <td style="text-align: left">Internet Control Message Protocol</td> </tr> <tr> <td style="text-align: left">igrp</td> <td style="text-align: left">Interior Gateway Routing Protocol</td> </tr> <tr> <td style="text-align: left">ip</td> <td style="text-align: left">Internet Protocol</td> </tr> <tr> <td style="text-align: left">ip6</td> <td style="text-align: left">Internet Protocol version 6</td> </tr> <tr> <td style="text-align: left">pim</td> <td style="text-align: left">Protocol Independent Multicast</td> </tr> <tr> <td style="text-align: left">rarp</td> <td style="text-align: left">Reverse Address Resolution Protocol</td> </tr> <tr> <td style="text-align: left">stp</td> <td style="text-align: left">Spanning Tree Protocol</td> </tr> <tr> <td style="text-align: left">vrrp</td> <td style="text-align: left">Virtual Router Redundancy Protocol</td> </tr> </tbody> </table> <hr/> <p>IP Address: ip.addr == x.x.x.x<br/> MAC Address: eth.addr == xx:xx:xx:xx:xx:xx<br/> ICMP! My MAC Address: icmp eth.addr == xx:xx:xx:xx:xx:xx<br/> DHCP: bootp<br/> TCP Port: tcp.port == x<br/> UDP Port: udp.port == x<br/> TCP ACK RTT: tcp.analysis.ack_rtt &gt; 1<br/> TCP Length: &gt; x &lt; y tcp.len &gt; x &amp;&amp; tcp.len &lt; y<br/> Not My MAC: !eth.addr == xx:xx:xx:xx:xx:xx<br/></p> </div> </div> </div> </section> </div> </section> <div id="footer"> <div class="container"> <div class="row "> <section class="6u"> <h3>More Links to Stuff</h3> <ul class="url"> <li><a href="/etc/calendar-next-4-months/">Calendar For Next Four Months</a></li><li><a href="/javaee/ws/soapvsrest/">SOAP vs REST</a></li><li><a href="/web/regex/">Regex</a></li><li><a href="/javaee/spring/security/credential/">Spring Security Credentails See Password at Session</a></li><li><a href="/etc/curl/">Curl Command</a></li><li><a href="/etc/http2/">HTTP/2 Explained</a></li> </ul> </section> <section class="6u"> <h3>Search Posts</h3> <form action="get" id="site_search"> <input type="text" id="search_box"> <input type="submit" value="Search"> </form> <ul id="search_results"></ul> </section> </div> </div> <ul class="icons"> <li><a href="http://github.com/pujansrt" class="icon fa-github"><span class="label">GitHub</span></a></li> <li><a href="http://www.linkedin.com/in/pujansrt" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li> <li><a href="https://plus.google.com/+PujanSrivastava" class="icon fa-google-plus"><span class="label">Google+</span></a></li> </ul> <div class="copyright"> <ul class="menu"> <li>&copy; Appkubos. All rights reserved 2010-2016</li> </ul> </div> </div> <script>(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.appkubos.com/assets/js/analytics.js","ga");ga("create","UA-72013918-1","auto");ga("send","pageview");$(function(a){$(".headmenu").each(function(b){var c=$(this);if($(c).attr("data-curr")==$(c).attr("data-cat")){$(c).addClass("current")}});loadAsyncCSS("https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css");loadAsyncCSS("/assets/css/pygments.css")});function loadAsyncCSS(a){if(document.createStyleSheet){document.createStyleSheet(a)}else{$("head").append($("<link rel='stylesheet' href='"+a+"' type='text/css' media='screen' />"))}};</script> </body> </html>