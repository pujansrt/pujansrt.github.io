<!DOCTYPE HTML> <html lang="en-US"> <head> <title>AppKubos: How to Avoid Null Pointer Exception</title> <meta http-equiv="content-type" content="text/html; charset=utf-8"/> <meta name="HandheldFriendly" content="True"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="referrer" content="origin"/> <link rel="icon" href="/favicon.ico" type="image/x-icon"> <!--[if lte IE 8]><script src="/assets/css/ie/html5shiv.js"></script><![endif]--> <noscript> <link rel="stylesheet" href="/assets/css/skel.css"/> <link rel="stylesheet" href="/assets/css/style.css"/> <link rel="stylesheet" href="/assets/css/style-wide.css"/> </noscript> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> <script async src="/assets/js/jquery.dropotron.min.js"></script> <script src="/assets/js/skel.min.js"></script> <script src="/assets/js/skel-layers.min.js"></script> <script src="/assets/js/init.js"></script> <script async src="/assets/js/lunr.min.js"></script> <script async src="/assets/js/search.js"></script> <link rel="alternate" type="application/rss+xml" title="AppKubos" href="http://www.appkubos.com/feed.xml"/> </head> <body> <div id="header"> <nav id="nav"> <ul> <li><a href="/">Home</a></li> <li><a href="/pujan">About</a></li> <li class="headmenu" data-cat="javaee" data-curr="javaee"> <a name="JavaEE">JavaEE</a> <ul> <li><a href=""></a></li> <li><a href="/javaee/ws/soapvsrest/">SOAP vs REST</a></li> <li><a href="/javaee/spring/security/credential/">Spring Security Credentails See Password at Session</a></li> <li><a href="/javaee/spring/configuration/">Spring Security Configuration with Form Login</a></li> <li><a href="/javaee/jboss/jspfix/">JBoss Fix for JSP</a></li> <li><a href="/javaee/processbuilder/">How to Run System Commands in Java</a></li> <li><a href="/javaee/jackson/csv-creator/">CSV Creator using Jackson</a></li> <li><a href="/javaee/jaxws/sample-webservice/">JAX-WS Webservices using Annotations</a></li> </ul> </li><li class="headmenu" data-cat="other" data-curr="javaee"> <a name="Other">Other</a> <ul> <li><a href=""></a></li> <li><a href="/etc/calendar-next-4-months/">Calendar For Next Four Months</a></li> <li><a href="/etc/curl/">Curl Command</a></li> <li><a href="/etc/http2/">HTTP/2 Explained</a></li> <li><a href="/etc/tshark-commands/">TShark Commands</a></li> <li><a href="/etc/latency/">Latency Comparison</a></li> <li><a href="/etc/scala-introduction/">Scala Introduction</a></li> <li><a href="/etc/groovy-run-from-java/">Run Groovy from Java</a></li> </ul> </li><li class="headmenu" data-cat="python" data-curr="javaee"> <a name="Python">Python</a> <ul> <li><a href=""></a></li> <li><a href="/python/tutorial/">Python Tutorial</a></li> <li><a href="/python/file-handling/">Python File Handling</a></li> <li><a href="/python/dictionary/">Python Dictionary</a></li> </ul> </li><li class="headmenu" data-cat="integration" data-curr="javaee"> <a name="Integration">Integration</a> <ul> <li><a href=""></a></li> <li><a href="/integration/microservices/">Microservices Explained</a></li> <li><a href="/integration/oauth2/">OAuth2 Architecture</a></li> </ul> </li> </ul> </nav> </div> <section class="wrapper style1"> <div class="container"> <section> <header class="major"> <h2>How to Avoid Null Pointer Exception</h2> </header> <div class="row"> <div class="12u"> <div class="box post"> <h2 id="minimize-the-use-of-null-in-assignment">Minimize the use of ‘null’ in assignment</h2> <p>Try to avoid as much as possible:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">s</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>

<span class="k">while</span> <span class="o">(</span><span class="n">something</span><span class="o">){</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">something2</span><span class="o">)</span> <span class="n">s</span><span class="o">=</span><span class="s">&quot;yep&quot;</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">!=</span><span class="kc">null</span><span class="o">)</span> <span class="n">something3</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">//You can replace above with this:</span>

<span class="kt">boolean</span> <span class="n">done</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span>
<span class="k">while</span> <span class="o">(!</span><span class="n">done</span> <span class="o">&amp;&amp;</span> <span class="n">something</span><span class="o">){</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">something2</span><span class="o">){</span>
        <span class="n">done</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span>
        <span class="n">something3</span><span class="o">(</span><span class="s">&quot;yep&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <h2 id="prefer-valueof-over-tostring-where-both-return-same-result">Prefer valueOf() over toString() where both return same result</h2> <p>Since calling toString() on null object throws NullPointerException, if we can get same value by calling valueOf() then prefer that, as passing null to valueOf() returns “null”, specially in case of wrapper classes like Integer, Float, Double or BigDecimal.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">BigDecimal</span> <span class="n">bd</span> <span class="o">=</span> <span class="n">getPrice</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">bd</span><span class="o">));</span> <span class="c1">//doesn&#39;t throw NPE</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bd</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>      <span class="c1">//Throws java.lang.NullPointerException&quot;</span></code></pre></figure> <h2 id="comparing-string-variable-with-a-string-literal">Comparing String Variable with a String literal</h2> <p>When you compare a variable with a string literal, always put the string literal first. Example:</p> <p>NullPointerException if state variable is null</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Object</span> <span class="n">unknownObject</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="k">if</span><span class="o">(</span><span class="n">unknownObject</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;knownObject&quot;</span><span class="o">))</span><span class="c1">// NPE</span>
<span class="o">{</span>
    <span class="c1">//</span>
<span class="o">}</span>
<span class="c1">//No problem even if state variable is null</span>

<span class="n">Object</span> <span class="n">unknownObject</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="k">if</span><span class="o">(</span><span class="s">&quot;knownObject&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">unknownObject</span><span class="o">))</span> <span class="c1">// Good</span>
<span class="o">{</span>
    <span class="c1">//</span>
<span class="o">}</span></code></pre></figure> <p>You might also consider replacing null with “” in the first example, but default values bring about bugs caused by default values being left in place. A NullPointerException is actually better, as it allows the runtime to tell you about the bug, rather than just continue with a default value.</p> <h2 id="using-null-safe-methods-and-libraries">Using null safe methods and libraries</h2> <p>There are lot of open source library out there, which does the heavy lifting of checking null for you. One of the most common one is StringUtils from Apache commons. You can use StringUtils.isBlank(), isNumeric(), isWhiteSpace() and other utility methods without worrying of NullPointerException.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">//StringUtils methods are null safe, they don&#39;t throw NullPointerException</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isNumeric</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isAllUpperCase</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>


<span class="c1">//Output:</span>
<span class="kc">true</span>
<span class="kc">true</span>
<span class="kc">false</span>
<span class="kc">false</span></code></pre></figure> <h2 id="minimize-the-use-of-array">Minimize the use of Array</h2> <p>Minimize the use of the new Type[int] syntax for creating arrays of objects. An array created using new Object[10] has 10 null pointers. That’s 10 more than we want, so use collections instead, or explicitly fill the array at initialisation with:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Object</span><span class="o">[]</span> <span class="n">objects</span><span class="o">={</span><span class="s">&quot;blah&quot;</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="o">)};</span>

<span class="c1">// Or </span>

<span class="n">Object</span><span class="o">[]</span> <span class="n">objects</span><span class="o">;</span>
<span class="n">objects</span><span class="o">=</span><span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="s">&quot;blah&quot;</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="o">)};</span></code></pre></figure> <p>Now, check all references used, in the array declarations, obtained from ‘untrusted’ methods It is possible that some can return a null reference. Make sure you check these. For example: File.listFiles() can return null if “/etc” is not a directory.</p> <h2 id="notnull-and-nullable-annotations-jdk-7">@NotNull and @Nullable Annotations (JDK 7+)</h2> <p>@NotNull and @Nullable are life-saver annotations and designed to help you watch contracts throughout method hierarchy. Consequently this will avoid emergence of NPEs. With these tiny annotations, you can save a lot of time. Let’s look at the usage of these annotations:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">getDefinition</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">getDefinition</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;DEFINITION&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="c1">// ...</span>
   <span class="o">}</span>
   <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure> <p>When you try to invoke a @Nullable method (in this case it’s getDefinition), you’ll receive a warning that says: “getDefinition may product NPE”. Now you know that you have to check for NPE. Isn’t that nice? Now let’s look at the @NotNull annotation’s usage:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">User</span> <span class="nf">findUser</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// ...</span>
   <span class="c1">// ...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// try invoking with null parameter</span>
   <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">findUser</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
   <span class="c1">// ...</span>
   <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure> <p>If you try to invoke the findUser method with @NotNull, you’ll receive a warning that says: “Passing ‘null’ argument to a method annotated @NotNull”. By using these annotations, it’s almost impossible to receive an NPE from your code base (I ignored the 3rd party tools).</p> <p>As you see, these are really nice annotations. However, the bad news is that they’re not really friendly if you’re not using IntelliJ. For more information about these annotations, please look at the how-to documentation.</p> <h2 id="java-assertions">Java Assertions</h2> <p>Java assertion is a statement that enables you to test your assumptions about your code. For example, if you write a method that returns the quantity of products in the system, you might assert that the returning quantity should be greater than or equal to 0. They are used to verify the correctness of an invariant in the code. They should never be triggered in production code, and are indicative of a bug or misuse of a code path. They can be activated at run-time by way of the -ea option on the java command, but are not turned on by default.</p> <p>Use:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">assert</span> <span class="o">&lt;</span><span class="n">Expression</span><span class="o">&gt;;</span> 
<span class="err">#</span> <span class="n">OR</span> <span class="n">another</span> <span class="n">usage</span> <span class="n">is</span>
<span class="k">assert</span> <span class="o">&lt;</span><span class="n">Expression1</span><span class="o">&gt;</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">Expression2</span><span class="o">&gt;;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>
  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AssertionExample</span><span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span> <span class="n">String</span> <span class="n">args</span><span class="o">[]</span> <span class="o">){</span>
  <span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Scanner</span><span class="o">(</span> <span class="n">System</span><span class="o">.</span><span class="na">in</span> <span class="o">);</span>
 
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span> <span class="s">&quot;Enter a number between 0 and 20: &quot;</span> <span class="o">);</span>
  <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
  <span class="k">assert</span><span class="o">(</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">20</span> <span class="o">)</span> <span class="o">:</span> <span class="s">&quot;Invalid number: &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span> <span class="s">&quot;You have entered %d\n&quot;</span><span class="o">,</span> <span class="n">value</span> <span class="o">);</span>
 <span class="o">}</span> 
<span class="o">}</span></code></pre></figure> <p>//Compile the example with: javac AssertionExample.java //Run the example with: java -ea AssertionExample So far it’s okay, but how are we gonna use it to avoid NPEs? Very simple. There are two ways to use assertions in your code base:</p> <p>First, direct usage. Please check the following code:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">getUserDetails</span><span class="o">(</span><span class="kd">final</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// make sure that user is not null</span>

   <span class="k">assert</span> <span class="o">(</span><span class="n">user</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">:</span> <span class="s">&quot;User cannot be null&quot;</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure> <p>Second way of using assertions is creating an Assert utility class as in Spring. You can put various assertions into this utility class for your project like isEmpty(), isValidCountryCode(), etc.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomethingWithUser</span><span class="o">(</span><span class="kd">final</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// make sure that user is not null</span>

   <span class="n">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="s">&quot;User cannot be null&quot;</span><span class="o">);</span>
   <span class="n">Assert</span><span class="o">.</span><span class="na">hasLength</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getLastName</span><span class="o">(),</span> <span class="s">&quot;User must have a last name&quot;</span><span class="o">);</span>

   <span class="c1">// etc..</span></code></pre></figure> <p>I want to highlight one thing here. Assertions should be available only in the development process, and not in the production environment. And one more thing, you shouldn’t use any business logic with the assert keyword. Otherwise when assertions are gone after development, your code doesn’t work.</p> <h2 id="factory-pattern">Factory Pattern</h2> <p>Factory Pattern is a design pattern that is used to create concrete objects. The idea is preventing developers to have their own object creation and initialization (I10N) code within various part of the project. By using factory pattern, you would have a centralized object creation and initialization, and you would prevent mis-initialization problems. For more information about the pattern, please check Gang of Four’s official design patterns page.</p> <p>Now let’s look at how to use this method to avoid NPEs. Please look at the following example:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">myPrettyService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">dummyObject</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure> <p>At first look, it seems like there is no problem in the code. However, careful eyes can catch that myPrettyService might not be initialized at all. This is one common problem of using services/DAOs or any external provider’s instance. Yes it might be null. To prevent this, people tend to create a Singleton of these services. We all know that Singletons are evil in most cases (there are exceptions). To avoid NPE and Singleton together, factory pattern saves us :) Please check the following code:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">ServiceFactory</span><span class="o">.</span><span class="na">getMyPrettyService</span><span class="o">().</span><span class="na">save</span><span class="o">(</span><span class="n">dummyObject</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure> <p>ServiceFactory returns only a single instance of our service every time we invoke it (a little singleton hint is by using reflection and making service’s constructor private).</p> <h2 id="accurate-exception-handling">Accurate Exception Handling</h2> <p>One common mistake is not throwing exceptions. I think the reason is that people find try-catch blocks ugly. However, they’re also life-savers, especially pin-pointing the problematic areas in your code-base. Right now, probably you’re thinking what’s the relation between avoiding NPEs and throwing exceptions. Let me tell you why accurate exception handling is important. First, look at the following code snippet:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">User</span> <span class="nf">findByGuid</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">guid</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">executeNamedQuery</span><span class="o">(</span><span class="n">FIND_BY_GUID</span><span class="o">);</span>

   <span class="k">if</span> <span class="o">(!</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// EDIT from comments</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure> <p>As you see, our guy is trying to reach the User by querying the database and returning the result, if there is any, otherwise it returns null. You see this kind of code everywhere, maybe even you’re coding just like this. Maybe you think nothing is wrong with this code. Let me tell what is wrong with this code snippet. Since this method is public, anyone can invoke it. People who use this method might forget to null check for the result, especially if our guy is not a good documenter :S (java developers tend to forget JavaDocs I don’t know why :P). As in following code:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findByGuid</span><span class="o">(</span><span class="s">&quot;XYZ&quot;</span><span class="o">);</span>
   <span class="n">String</span> <span class="n">licenseNumber</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getLicenseCode</span><span class="o">().</span><span class="na">getEncryptedLicenseNumber</span><span class="o">();</span>

   <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure> <p>Unfortunately, this usage seems perfect, but it throws NPE at run-time :( And then you would try to understand what’s wrong with your code. After finding that this user is null, like most developers you tend to place a quick &amp; dirty fix as below:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findByGuid</span><span class="o">(</span><span class="s">&quot;XYZ&quot;</span><span class="o">);</span>
   
   <span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">licenseNumber</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getLicenseCode</span><span class="o">().</span><span class="na">getEncryptedLicenseNumber</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure> <p>I guess now we’re on the same page. If this guy would have thrown an exception instead of returning null, you would never end up with an NPE. Instead of throwing an accurate exception, now you’re struggling with an NPE. From this point, I’m leaving it to your considerations:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">User</span> <span class="nf">findByGuid</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">guid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">UserNotFoundException</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">executeNamedQuery</span><span class="o">(</span><span class="n">FIND_BY_GUID</span><span class="o">);</span>

   <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="k">throw</span> <span class="nf">UserNotFoundException</span><span class="o">(</span><span class="s">&quot;NoUser found with guid: %1$s&quot;</span><span class="o">,</span> <span class="n">guid</span><span class="o">);</span><span class="c1">//or any ServiceException u like</span>
<span class="o">}</span></code></pre></figure> <h2 id="empty-collections">Empty Collections</h2> <p>Don’t return null from your service methods like below:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">User</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">getUsers</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">Result</span> <span class="n">result</span><span class="o">=</span><span class="n">executeQuery</span><span class="o">(</span><span class="n">GET_ALL_USERS</span><span class="o">);</span>

   <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">instead</span> <span class="k">do</span> <span class="n">like</span> <span class="k">this</span><span class="o">:</span>

<span class="kd">public</span> <span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">User</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">getUsers</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">Result</span> <span class="n">result</span><span class="o">=</span><span class="n">executeQuery</span><span class="o">(</span><span class="n">GET_ALL_USERS</span><span class="o">);</span>

   <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">EMPTY_LIST</span><span class="o">;</span> 
   <span class="c1">// or EMPTY_SET or EMPTY_MAP, etc.</span>
<span class="o">}</span></code></pre></figure> <h2 id="too-many-dot-syntax">Too Many Dot Syntax</h2> <p>If your object is not a builder object, don’t use too many dot syntax in your code like below:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">attrValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">findViewObject</span><span class="o">(</span><span class="s">&quot;VO_NAME&quot;</span><span class="o">).</span><span class="na">getCurrentRow</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;Attribute_NAME&quot;</span><span class="o">);</span>
<span class="n">instead</span> <span class="k">do</span> <span class="n">like</span> <span class="k">this</span><span class="o">:</span>

<span class="n">ViewObject</span> <span class="n">vo</span> <span class="o">=</span> <span class="n">findViewObject</span><span class="o">(</span><span class="s">&quot;VO_NAME&quot;</span><span class="o">);</span> 
<span class="n">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="na">getCurrentRow</span><span class="o">();</span> 
<span class="n">String</span> <span class="n">attrValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">row</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;Attribute_NAME&quot;</span><span class="o">);</span></code></pre></figure> <h2 id="use-contains-containskey-containsvalue">Use contains(), containsKey(), containsValue()</h2> <p>Don’t do like this:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>

   <span class="n">TaxCode</span> <span class="n">taxC</span> <span class="o">=</span> <span class="n">taxCodeMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;Turkey&quot;</span><span class="o">);</span>

   <span class="c1">// ...</span>
<span class="o">}</span>
<span class="n">instead</span> <span class="k">do</span> <span class="n">like</span> <span class="k">this</span><span class="o">:</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">taxCodeMap</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">&quot;Turkey&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">TaxCode</span> <span class="n">taxC</span> <span class="o">=</span> <span class="n">taxCodeMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;Turkey&quot;</span><span class="o">);</span>
   <span class="o">}</span>
   <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure> <h2 id="unit-testing">Unit Testing</h2> <p>This should be a default action for an agile developer. If you discover an NPE in your code, please update your Unit Tests. And of course before having this problem, make sure that your Unit is already covered for NPEs</p> <h2 id="aspect-oriented-programming">Aspect Oriented Programming</h2> <p>This is a really big topic. So I’ll cut it short. Try to look at Aspect Oriented Programming. By using AOP, you might have some neat way of handling NPEs (by inserting following code).</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">object</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span> 
  <span class="n">handleNull</span><span class="o">();</span> 
<span class="o">}</span> </code></pre></figure> <h2 id="null-object-pattern">Null Object Pattern</h2> <p>Martin Fowler’s Refactoring book covers this topic very nice. However I find it very un-practical. Then again, it’s wise to have a quick look on this pattern. The basic idea of pattern is creating a Null version of your possible error-prone objects.</p> <p>Ternary Operator</p> <p>This operator results to the value on the left hand side if not null else right hand side is evaluated. It has syntax like :</p> <p>boolean expression ? value1 : value2; If expression is evaluated as true then entire expression returns value1 otherwise value2. Its more like if-else construct but it is more effective and expressive. To prevent NullPointerException (NPE) , use this operator like below code:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="o">(</span><span class="n">param</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="s">&quot;NA&quot;</span> <span class="o">:</span> <span class="n">param</span><span class="o">;</span></code></pre></figure> <h2 id="instanceof-operator">instanceof operator</h2> <p>The instanceof operator is NPE safe. So, instanceof null always returns false. It does not cause a NPE. You can eliminate messy conditional code if you remember this fact.</p> <p>Try to avoid as much as possible:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;</span><span class="n">amp</span><span class="o">;&amp;</span><span class="n">amp</span><span class="o">;</span> <span class="n">data</span> <span class="k">instanceof</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>

<span class="o">}</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">use</span> <span class="n">multitple</span> <span class="nl">conditions:</span>

<span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="k">instanceof</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>

<span class="o">}</span></code></pre></figure> <h2 id="accessing-static-members-of-a-class">Accessing static members of a class</h2> <p>If you are dealing with static variables or static method than you won’t get null pointer exception even if you have your reference variable pointing to null because static variables and method call are bonded during compile time based on class name and not associated with object</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">MyObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">String</span> <span class="n">attrib</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">staticAttr</span><span class="o">;</span> <span class="c1">//no NPE as staticAttr is static variable defined in class MyObject</span></code></pre></figure> </div> </div> </div> </section> </div> </section> <div id="footer"> <div class="container"> <div class="row "> <section class="6u"> <h3>More Links to Stuff</h3> <ul class="url"> <li><a href="/etc/calendar-next-4-months/">Calendar For Next Four Months</a></li><li><a href="/javaee/ws/soapvsrest/">SOAP vs REST</a></li><li><a href="/web/regex/">Regex</a></li><li><a href="/javaee/spring/security/credential/">Spring Security Credentails See Password at Session</a></li><li><a href="/etc/curl/">Curl Command</a></li><li><a href="/etc/http2/">HTTP/2 Explained</a></li> </ul> </section> <section class="6u"> <h3>Search Posts</h3> <form action="get" id="site_search"> <input type="text" id="search_box"> <input type="submit" value="Search"> </form> <ul id="search_results"></ul> </section> </div> </div> <ul class="icons"> <li><a href="http://github.com/pujansrt" class="icon fa-github"><span class="label">GitHub</span></a></li> <li><a href="http://www.linkedin.com/in/pujansrt" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li> <li><a href="https://plus.google.com/+PujanSrivastava" class="icon fa-google-plus"><span class="label">Google+</span></a></li> </ul> <div class="copyright"> <ul class="menu"> <li>&copy; Appkubos. All rights reserved 2010-2016</li> </ul> </div> </div> <script>(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.appkubos.com/assets/js/analytics.js","ga");ga("create","UA-72013918-1","auto");ga("send","pageview");$(function(a){$(".headmenu").each(function(b){var c=$(this);if($(c).attr("data-curr")==$(c).attr("data-cat")){$(c).addClass("current")}});loadAsyncCSS("https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css");loadAsyncCSS("/assets/css/pygments.css")});function loadAsyncCSS(a){if(document.createStyleSheet){document.createStyleSheet(a)}else{$("head").append($("<link rel='stylesheet' href='"+a+"' type='text/css' media='screen' />"))}};</script> </body> </html>