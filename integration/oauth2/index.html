<!DOCTYPE HTML> <html lang="en-US"> <head> <title>AppKubos: OAuth2 Architecture</title> <meta http-equiv="content-type" content="text/html; charset=utf-8"/> <meta name="description" content="Spring Security OAuth2 Architecture"/> <meta name="HandheldFriendly" content="True"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="referrer" content="origin"/> <link rel="icon" href="/favicon.ico" type="image/x-icon"> <!--[if lte IE 8]><script src="/assets/css/ie/html5shiv.js"></script><![endif]--> <noscript> <link rel="stylesheet" href="/assets/css/skel.css"/> <link rel="stylesheet" href="/assets/css/style.css"/> <link rel="stylesheet" href="/assets/css/style-wide.css"/> </noscript> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> <script async src="/assets/js/jquery.dropotron.min.js"></script> <script src="/assets/js/skel.min.js"></script> <script src="/assets/js/skel-layers.min.js"></script> <script src="/assets/js/init.js"></script> <script async src="/assets/js/lunr.min.js"></script> <script async src="/assets/js/search.js"></script> <link rel="alternate" type="application/rss+xml" title="AppKubos" href="http://www.appkubos.com/feed.xml"/> </head> <body> <div id="header"> <nav id="nav"> <ul> <li><a href="/">Home</a></li> <li><a href="/pujan">About</a></li> <li class="headmenu" data-cat="javaee" data-curr="integration"> <a name="JavaEE">JavaEE</a> <ul> <li><a href=""></a></li> <li><a href="/javaee/ws/soapvsrest/">SOAP vs REST</a></li> <li><a href="/javaee/spring/security/credential/">Spring Security Credentails See Password at Session</a></li> <li><a href="/javaee/spring/configuration/">Spring Security Configuration with Form Login</a></li> <li><a href="/javaee/jboss/jspfix/">JBoss Fix for JSP</a></li> <li><a href="/javaee/processbuilder/">How to Run System Commands in Java</a></li> <li><a href="/javaee/jackson/csv-creator/">CSV Creator using Jackson</a></li> <li><a href="/javaee/jaxws/sample-webservice/">JAX-WS Webservices using Annotations</a></li> </ul> </li><li class="headmenu" data-cat="other" data-curr="integration"> <a name="Other">Other</a> <ul> <li><a href=""></a></li> <li><a href="/etc/calendar-next-4-months/">Calendar For Next Four Months</a></li> <li><a href="/etc/curl/">Curl Command</a></li> <li><a href="/etc/http2/">HTTP/2 Explained</a></li> <li><a href="/etc/tshark-commands/">TShark Commands</a></li> <li><a href="/etc/latency/">Latency Comparison</a></li> <li><a href="/etc/scala-introduction/">Scala Introduction</a></li> <li><a href="/etc/groovy-run-from-java/">Run Groovy from Java</a></li> </ul> </li><li class="headmenu" data-cat="python" data-curr="integration"> <a name="Python">Python</a> <ul> <li><a href=""></a></li> <li><a href="/python/tutorial/">Python Tutorial</a></li> <li><a href="/python/file-handling/">Python File Handling</a></li> <li><a href="/python/dictionary/">Python Dictionary</a></li> </ul> </li><li class="headmenu" data-cat="integration" data-curr="integration"> <a name="Integration">Integration</a> <ul> <li><a href=""></a></li> <li><a href="/integration/microservices/">Microservices Explained</a></li> <li><a href="/integration/oauth2/">OAuth2 Architecture</a></li> </ul> </li> </ul> </nav> </div> <section class="wrapper style1"> <div class="container"> <section> <header class="major"> <h2>OAuth2 Architecture</h2> </header> <div class="row"> <div class="12u"> <div class="box post"> <p>OAuth2 is an authorization framework that enables applications to obtain limited access to user accounts on an HTTP service, such as Facebook, GitHub, Twitter etc. It works by delegating user authentication to the service that hosts the user account, and authorizing third-party applications to access the user account. OAuth 2 provides authorization flows for web and desktop applications, and mobile devices. OAuth2 is based on the RFC 6749 [<a title="RFC6749" href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>].</p> <h3 id="steps">Steps:</h3> <p><i class="conum">1</i> App requests OAuth2 to access resource (API) with username/password.</p> <p><i class="conum">2</i> Upon successful, the app receives two tokens: {access_token} and {refresh_token}</p> <p><i class="conum">3</i> Now app supplies {access_token} whenever it wishes to access API. Whenever {access_token} expires, app can request to get new set of token without sending username/password to OAuth2 but {refresh_token}. Eventually, {refresh_token} does expire after some validity period, in that case app need to send username/password this time.</p> <p><i class="conum">4</i> Now in order to access SERVICE app send REQUEST along with access token.If the access token is valid, the SERVICE serves the resource to the app</p> <p><a href="http://www.appkubos.com/assets/images/oauth2.png"><img class="alignnone size-full wp-image-622" src="http://www.appkubos.com/assets/images/oauth2.png" alt="oauth2" width="600" height="600"/></a></p> <p>Note: The actual flow of this process will differ depending on the authorization grant type in use, but this is the general idea.</p> <p>Now comes the configuration part. Lets consider Spring Security for explanation-</p> <p><strong>How to use InMemory Token Store in Spring Security</strong></p> <p>There are various ways to store tokens: In Memory, Database, File etc. If you want to change from InMemory Token store in Spring Security then you have to change From</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;tokenStore&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.oauth2.provider.token.InMemoryTokenStore&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <p>To</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;tokenStore&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.oauth2.provider.token.JdbcTokenStore&quot;</span><span class="nt">&gt;</span>
	<span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&quot;jdbcTemplate&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;jdbcTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span><span class="nt">&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;jdbc:mysql://localhost:3306/oauthdb&quot;</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;root&quot;</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre></figure> <h3 id="database-for-token-store">Database for Token Store</h3> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">oauth_client_details</span> <span class="p">(</span>
    <span class="n">client_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">,</span> 
    <span class="n">resource_ids</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">client_secret</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="k">scope</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">authorized_grant_types</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">web_server_redirect_uri</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">authorities</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">access_token_validity</span> <span class="nb">INTEGER</span> <span class="p">,</span> 
    <span class="n">refresh_token_validity</span> <span class="nb">INTEGER</span> <span class="p">,</span> 
    <span class="n">additional_information</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">4096</span><span class="p">)</span> 
<span class="p">);</span> 

<span class="k">create</span> <span class="k">table</span> <span class="n">oauth_client_token</span> <span class="p">(</span>
    <span class="n">token_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">token</span> <span class="nb">BLOB</span> <span class="p">,</span> 
    <span class="n">authentication_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">user_name</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">client_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span> 
<span class="p">);</span>  

<span class="k">create</span> <span class="k">table</span> <span class="n">oauth_access_token</span> <span class="p">(</span>
    <span class="n">token_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">token</span> <span class="nb">BLOB</span> <span class="p">,</span> 
    <span class="n">authentication_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">user_name</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">client_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">authentication</span> <span class="nb">BLOB</span> <span class="p">,</span> 
    <span class="n">refresh_token</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span> 
<span class="p">);</span>  

<span class="k">create</span> <span class="k">table</span> <span class="n">oauth_refresh_token</span> <span class="p">(</span>
    <span class="n">token_id</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">token</span> <span class="nb">BLOB</span> <span class="p">,</span> 
    <span class="n">authentication</span> <span class="nb">BLOB</span> 
<span class="p">);</span>  

<span class="k">create</span> <span class="k">table</span> <span class="n">oauth_code</span> <span class="p">(</span>
    <span class="n">code</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">authentication</span> <span class="nb">BLOB</span> 
<span class="p">);</span>   

<span class="k">create</span> <span class="k">table</span> <span class="n">ClientDetails</span> <span class="p">(</span>
    <span class="n">appId</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">,</span> 
    <span class="n">resourceIds</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">appSecret</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="k">scope</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">grantTypes</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">redirectUrl</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">authorities</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">256</span><span class="p">),</span> 
    <span class="n">access_token_validity</span> <span class="nb">INTEGER</span> <span class="p">,</span> 
    <span class="n">refresh_token_validity</span> <span class="nb">INTEGER</span> <span class="p">,</span> 
    <span class="n">additionalInformation</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">4096</span><span class="p">)</span> 
<span class="p">);</span></code></pre></figure> </div> </div> </div> </section> </div> </section> <div id="footer"> <div class="container"> <div class="row "> <section class="6u"> <h3>More Links to Stuff</h3> <ul class="url"> <li><a href="/etc/calendar-next-4-months/">Calendar For Next Four Months</a></li><li><a href="/javaee/ws/soapvsrest/">SOAP vs REST</a></li><li><a href="/web/regex/">Regex</a></li><li><a href="/javaee/spring/security/credential/">Spring Security Credentails See Password at Session</a></li><li><a href="/etc/curl/">Curl Command</a></li><li><a href="/etc/http2/">HTTP/2 Explained</a></li> </ul> </section> <section class="6u"> <h3>Search Posts</h3> <form action="get" id="site_search"> <input type="text" id="search_box"> <input type="submit" value="Search"> </form> <ul id="search_results"></ul> </section> </div> </div> <ul class="icons"> <li><a href="http://github.com/pujansrt" class="icon fa-github"><span class="label">GitHub</span></a></li> <li><a href="http://www.linkedin.com/in/pujansrt" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li> <li><a href="https://plus.google.com/+PujanSrivastava" class="icon fa-google-plus"><span class="label">Google+</span></a></li> </ul> <div class="copyright"> <ul class="menu"> <li>&copy; Appkubos. All rights reserved 2010-2016</li> </ul> </div> </div> <script>(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.appkubos.com/assets/js/analytics.js","ga");ga("create","UA-72013918-1","auto");ga("send","pageview");$(function(a){$(".headmenu").each(function(b){var c=$(this);if($(c).attr("data-curr")==$(c).attr("data-cat")){$(c).addClass("current")}});loadAsyncCSS("https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css");loadAsyncCSS("/assets/css/pygments.css")});function loadAsyncCSS(a){if(document.createStyleSheet){document.createStyleSheet(a)}else{$("head").append($("<link rel='stylesheet' href='"+a+"' type='text/css' media='screen' />"))}};</script> </body> </html>